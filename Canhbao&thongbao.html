<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SmartExpense — Cài đặt</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg:#eaf3f9; --card:#fff; --text:#0f172a; --muted:#64748b;
    --border:#e5e7eb; --blue:#2563eb;
    --radius:14px; --shadow:0 10px 26px rgba(15,23,42,.06);
  }
  html.dark{
    --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#9aa4b2;
    --border:#1f2a44; --blue:#3b82f6;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    display:grid;grid-template-columns:260px 1fr;min-height:100vh;
  }

  /* Sidebar */
  .sidebar{background:var(--card);border-right:1px solid var(--border);padding:18px 14px}
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
  .brand .logo{width:40px;height:40px;border-radius:10px;overflow:hidden;background:#ffe8e0;display:grid;place-items:center;box-shadow:var(--shadow)}
  .brand .logo img{width:100%;height:100%;object-fit:cover;display:block}
  .brand b{font-size:18px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .nav{display:flex;flex-direction:column;gap:6px}
  .nav a{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;color:var(--text);font-weight:700;text-decoration:none}
  .nav a .i{width:18px;text-align:center}
  .nav a:hover{background:rgba(37,99,235,.12)}
  .nav a.active{background:var(--blue);color:#fff}

  .main{padding:22px 24px 40px}

  /* Language segmented (giống Cài đặt) */
  .segmented{
    display:inline-flex;border:1px solid var(--border);border-radius:999px;background:#f8fafc;overflow:hidden
  }
  html.dark .segmented{background:transparent}
  .segmented button{
    padding:6px 12px;font-weight:800;background:transparent;border:0;cursor:pointer;color:var(--text)
  }
  .segmented button+button{border-left:1px solid var(--border)}
  .segmented button.active{background:var(--blue);color:#fff}

  /* Alert center */
  .alert-outer{background:#eaf5ff;border:1px solid #cfe4ff;border-radius:18px;padding:18px}
  html.dark .alert-outer{background:#0f1a2e;border-color:#1f2a44}
  .alert-title{font-size:28px;font-weight:800;margin:2px 0 14px}
  .alert-shell{
    display:grid;grid-template-columns:1fr 360px;gap:0;
    background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);overflow:hidden
  }
  .alert-left{padding:16px}
  .top-tools{display:flex;gap:12px;align-items:center;justify-content:flex-end;margin-bottom:8px}
  .tabs{display:flex;gap:24px;font-weight:800;align-items:center}
  .tabs a{color:var(--text);text-decoration:none;padding:8px 0;position:relative}
  .tabs a.active::after{content:"";position:absolute;left:0;right:0;bottom:-10px;height:3px;border-radius:3px;background:var(--text)}
  .divider{height:2px;background:var(--border);margin-top:10px}

  .tools{display:flex;gap:10px;align-items:center;margin:12px 0}
  .btn-outline{height:38px;border:1px solid var(--border);background:var(--card);color:var(--text);border-radius:10px;padding:0 14px;font-weight:700;cursor:pointer}
  .search{margin-left:auto}
  .search input{width:260px;height:38px;border:1px solid var(--border);border-radius:999px;padding:0 12px;background:#f8fafc;color:#0f172a;outline:none}
  html.dark .search input{background:transparent;color:var(--text)}

  .list{margin-top:8px}
  .item{
    display:grid;grid-template-columns:110px 1fr 120px;gap:12px;align-items:center;
    border:1.5px solid #e6ebf2;background:var(--card);border-radius:14px;padding:12px 14px
  }
  html.dark .item{border-color:#1f2a44}
  .item + .item{margin-top:12px}
  .badge{display:inline-grid;place-items:center;width:90px;height:36px;border-radius:10px;font-weight:800}
  .badge.red{background:#fee2e2;border:1px solid #fecaca;color:#b91c1c}
  .badge.yellow{background:#fef3c7;border:1px solid #fde68a;color:#92400e}
  .item .t{font-weight:800;color:var(--text)}
  .item .sub{color:var(--muted);margin-top:2px}
  .item .time{color:var(--muted);text-align:right}
  .item.active{background:linear-gradient(0deg,rgba(17,24,39,.05),rgba(17,24,39,.05)),var(--card);border-color:#9aa5b1}
  html.dark .item.active{background:linear-gradient(0deg,rgba(59,130,246,.08),rgba(59,130,246,.08)),var(--card);border-color:#3b82f6}

  .right{border-left:2px solid var(--border);background:var(--card);padding:18px}
  .right h3{margin:0 0 18px;font-size:22px;font-weight:800}
  .right .sub{margin:0 0 8px;font-weight:800}
  .right .desc{color:var(--muted);margin:0 0 16px}
  .actions{display:flex;gap:12px;flex-wrap:wrap}
  .btn-primary{height:40px;border:0;border-radius:10px;background:var(--blue);color:#fff;font-weight:800;padding:0 14px;cursor:pointer}
  .btn-ghost{height:40px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--text);font-weight:800;padding:0 14px;cursor:pointer}
  .progress{height:12px;background:#eef2f7;border:1px solid #dbe1ea;border-radius:999px;overflow:hidden;width:100%;max-width:420px;margin-bottom:12px}
  .progress > i{display:block;height:100%;background:var(--blue);width:0%}
  html.dark .progress{background:#121c2f;border-color:#1f2a44}

  /* Chat */
  .pig-float{position:fixed;right:26px;bottom:26px;width:76px;height:76px;border-radius:18px;background:#ffe8e0;display:grid;place-items:center;box-shadow:var(--shadow);z-index:30;border:0;cursor:pointer}
  .pig-float img{width:64px;height:64px}
  .chatbox{position:fixed;right:26px;bottom:112px;width:340px;background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);overflow:hidden;display:none;z-index:40;grid-template-rows:56px 1fr 60px}
  .chatbox.open{display:grid}
  .chat-head{background:#1da1c9;color:#fff;display:flex;align-items:center;gap:10px;padding:10px 12px;font-weight:800}
  .chat-head img{width:28px;height:28px;border-radius:6px;background:#ffe8e0}
  .chat-body{background:#f4fbff;overflow:auto;padding:10px;max-height:380px}
  html.dark .chat-body{background:#0f1a2e}
  .msg{display:flex;align-items:flex-end;margin:8px 0;gap:8px}
  .bubble{max-width:78%;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:#fff;font-size:14px}
  html.dark .bubble{background:var(--card);color:var(--text)}
  .msg.user{justify-content:flex-end}
  .msg.user .bubble{background:var(--blue);border:none;color:#fff}
  .avatar-s{width:26px;height:26px;border-radius:50%;display:grid;place-items:center;background:#ffe8e0;flex:0 0 26px;font-size:14px}
  .chat-input{background:var(--card);border-top:1px solid var(--border);display:flex;align-items:center;gap:8px;padding:8px}
  #chatInput{flex:1;height:40px;border:1px solid var(--border);border-radius:999px;padding:0 12px;outline:none;background:#fff;color:#0f172a}
  html.dark #chatInput{background:transparent;color:var(--text)}
  #sendBtn{width:38px;height:38px;border-radius:999px;border:0;background:var(--blue);color:#fff;display:grid;place-items:center;cursor:pointer}
</style>
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo"><img src="https://play-lh.googleusercontent.com/oIYzM27-Lax7Zkg4grAxxLYRQkxHrs1osx0Qbf-jADQNpv9400yo0qYcLzDn-Qz2M8A=w480-h960-rw" alt=""></div>
      <b>SmartExpense</b>
    </div>
    <nav class="nav">
      <a href="trangchu.html"><span class="i">🏠</span> <span data-i18n="nav.overview">Tổng quan</span></a>
      <a href="danhsachchitieu.html"><span class="i">🧾</span> <span data-i18n="nav.list">Danh sách chi tiêu</span></a>
      <a href="lichsuchitieu.html"><span class="i">🕘</span> <span data-i18n="nav.history">Lịch sử chi tiêu</span></a>
      <a href="#"><span class="i">📅</span> <span data-i18n="nav.schedule">Lên lịch chi tiêu</span></a>
      <a href="loaichitieu.html"><span class="i">🏷️</span> <span data-i18n="nav.types">Loại chi tiêu</span></a>
      <a href="baocao.html"><span class="i">📊</span> <span data-i18n="nav.report">Báo cáo</span></a>
      <a href="hoso.html"><span class="i">👤</span> <span data-i18n="nav.profile">Hồ sơ</span></a>
      <a href="caidat.html" class="active"><span class="i">⚙️</span> <span data-i18n="nav.settings">Cài đặt</span></a>
      <a href="login.html"><span class="i">↪️</span> <span data-i18n="nav.logout">Đăng xuất</span></a>
    </nav>
  </aside>

  <!-- Main -->
  <main class="main">
    <div class="alert-outer">
      <div class="top-tools">
        <div class="segmented" id="langSeg" aria-label="Language">
          <button type="button" data-lang="vi" class="active">VI</button>
          <button type="button" data-lang="en">EN</button>
        </div>
      </div>
      <div class="alert-title" data-i18n="alerts.title">Cảnh báo & Thông báo</div>

      <div class="alert-shell">
        <!-- LEFT -->
        <section class="alert-left">
          <div class="tabs" id="tabs">
            <a href="#" class="active" data-tab="all"     data-i18n="tab.all">Tất cả</a>
            <a href="#" data-tab="budget"  data-i18n="tab.budget">Ngân sách</a>
            <a href="#" data-tab="anomaly" data-i18n="tab.anomaly">Bất thường</a>
          </div>
          <div class="divider"></div>

          <div class="tools">
            <button class="btn-outline" id="btnDelete" data-i18n="btn.delete">Xoá</button>
            <div class="search"><input id="q" placeholder="Tìm kiếm"></div>
          </div>

          <div class="list" id="list"></div>
          <div class="empty" id="empty" style="display:none" data-i18n="empty">Không có thông báo</div>
        </section>

        <!-- RIGHT -->
        <aside class="right" id="detail">
          <h3 data-i18n="detail.title">Chi tiết thông báo</h3>
          <div class="sub" id="d-title"></div>
          <p class="desc" id="d-desc"></p>

          <div class="progress" id="progress" style="display:none"><i></i></div>

          <div class="sub" data-i18n="actions.suggest">Đề xuất hành động</div>
          <div class="actions">
            <button class="btn-primary" id="act1"></button>
            <button class="btn-ghost"   id="act2"></button>
          </div>

          <p class="desc" id="d-tip" style="margin-top:14px"></p>
        </aside>
      </div>
    </div>
  </main>

  <!-- Chatbox -->
  <div id="chatbox" class="chatbox" aria-hidden="true">
    <div class="chat-head">
      <img src="https://play-lh.googleusercontent.com/oIYzM27-Lax7Zkg4grAxxLYRQkxHrs1osx0Qbf-jADQNpv9400yo0qYcLzDn-Qz2M8A=w480-h960-rw" alt="">
      <div>
        <div class="chat-title" data-i18n="chat.title">Trợ lý thông minh</div>
        <div class="chat-sub"   data-i18n="chat.sub">Xin chào! 👋 Rất vui khi được hỗ trợ bạn</div>
      </div>
    </div>
    <div id="chatBody" class="chat-body"></div>
    <div class="chat-input">
      <input id="chatInput" type="text" placeholder="Viết tin nhắn…">
      <button id="sendBtn" title="Gửi">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 12L20 4L12 20L11 13L4 12Z" fill="currentColor"/></svg>
      </button>
    </div>
  </div>
  <button id="chatToggle" class="pig-float" aria-label="Mở trợ lý">
    <img src="https://play-lh.googleusercontent.com/oIYzM27-Lax7Zkg4grAxxLYRQkxHrs1osx0Qbf-jADQNpv9400yo0qYcLzDn-Qz2M8A=w480-h960-rw" alt="">
  </button>

<script>
/* ===== Theme from settings (optional) ===== */
(function initTheme(){
  const saved = localStorage.getItem('theme');
  document.documentElement.classList.toggle('dark', saved === 'dark');
})();

/* ===== I18N ===== */
const I18N = {
  vi: {
    "nav.overview":"Tổng quan","nav.list":"Danh sách chi tiêu","nav.history":"Lịch sử chi tiêu",
    "nav.schedule":"Lên lịch chi tiêu","nav.types":"Loại chi tiêu","nav.report":"Báo cáo",
    "nav.profile":"Hồ sơ","nav.settings":"Cài đặt","nav.logout":"Đăng xuất",

    "alerts.title":"Cảnh báo & Thông báo",
    "tab.all":"Tất cả","tab.budget":"Ngân sách","tab.anomaly":"Bất thường",
    "btn.delete":"Xoá","empty":"Không có thông báo","detail.title":"Chi tiết thông báo",
    "actions.suggest":"Đề xuất hành động",
    "btn.adjustBudget":"Điều chỉnh ngân sách","btn.seeReport":"Xem báo cáo","btn.checkTx":"Kiểm tra giao dịch",
    "ph.search":"Tìm kiếm","ph.chat":"Viết tin nhắn…",
    "chat.title":"Trợ lý thông minh","chat.sub":"Xin chào! 👋 Rất vui khi được hỗ trợ bạn",
    "chat.greet":"Tôi là trợ lý SmartExpense. Bạn có thể nhờ tôi đổi cài đặt, bật/tắt thông báo hoặc hỏi mẹo sử dụng.",
    "chat.reply":"Mình đã nhận được yêu cầu. Bạn muốn mình làm gì tiếp theo?"
  },
  en: {
    "nav.overview":"Overview","nav.list":"Expense list","nav.history":"History",
    "nav.schedule":"Planner","nav.types":"Categories","nav.report":"Reports",
    "nav.profile":"Profile","nav.settings":"Settings","nav.logout":"Log out",

    "alerts.title":"Alerts & Notifications",
    "tab.all":"All","tab.budget":"Budget","tab.anomaly":"Anomalies",
    "btn.delete":"Delete","empty":"No notifications","detail.title":"Notification detail",
    "actions.suggest":"Suggested actions",
    "btn.adjustBudget":"Adjust budget","btn.seeReport":"See report","btn.checkTx":"Review transaction",
    "ph.search":"Search","ph.chat":"Type a message…",
    "chat.title":"Smart assistant","chat.sub":"Hello! 👋 Happy to help",
    "chat.greet":"I'm the SmartExpense assistant. I can change settings, toggle notifications, or share tips.",
    "chat.reply":"Got it. What would you like me to do next?"
  }
};
const langSeg = document.getElementById('langSeg');
function t(key){ const lang = localStorage.getItem('lang') || 'vi'; return (I18N[lang]&&I18N[lang][key])||key; }
function translatePage(){
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key=el.getAttribute('data-i18n'); el.textContent=t(key);
  });
  // placeholders
  document.getElementById('q').placeholder = t('ph.search');
  document.getElementById('chatInput').placeholder = t('ph.chat');
  // segmented active state
  const lang = localStorage.getItem('lang') || 'vi';
  [...langSeg.querySelectorAll('button')].forEach(b=> b.classList.toggle('active', b.dataset.lang===lang));
}

/* ===== Demo data with bilingual fields ===== */
const ALERTS = [
  { id:'b1', type:'budget',
    kind:{vi:'Thông báo',en:'Notice'},
    badge:'red',
    title:{vi:'Gần chạm ngưỡng',en:'Near threshold'},
    desc:{vi:'Danh mục Ăn uống đã dùng 55% ngân sách tháng.',en:'Food category has used 55% of monthly budget.'},
    time:{vi:'2 giờ trước',en:'2 hours ago'},
    tip:{vi:'Cắt giảm chi phí không cần thiết',en:'Cut non-essential expenses'},
    progress:55
  },
  { id:'b2', type:'budget',
    kind:{vi:'Cảnh báo',en:'Alert'}, badge:'red',
    title:{vi:'Nguy cơ vượt ngân sách',en:'Risk of overspending'},
    desc:{vi:'Dự báo Di chuyển sẽ vượt 12% vào 15/10.',en:'Transport is forecast to exceed by 12% on Oct 15.'},
    time:{vi:'Hôm nay, 08:15',en:'Today, 08:15'},
    tip:{vi:'Xem lại kế hoạch chi tiêu',en:'Review your spending plan'},
    progress:72
  },
  { id:'b3', type:'budget',
    kind:{vi:'Cảnh báo',en:'Alert'}, badge:'red',
    title:{vi:'Ngân sách vượt quá',en:'Budget exceeded'},
    desc:{vi:'Giải trí vượt 150,000đ so với ngân sách.',en:'Entertainment exceeded budget by 150,000₫.'},
    time:{vi:'2 ngày trước',en:'2 days ago'},
    tip:{vi:'Điều chỉnh ngân sách',en:'Adjust the budget'},
    progress:100
  },
  { id:'a1', type:'anomaly',
    kind:{vi:'Thông báo',en:'Notice'}, badge:'yellow',
    title:{vi:'Giao dịch bất thường nhẹ',en:'Mild anomaly detected'},
    desc:{vi:'Phát hiện mẫu chi tiêu không thường thấy.',en:'Unusual spending pattern detected.'},
    time:{vi:'2 giờ trước',en:'2 hours ago'},
    tip:{vi:'Kiểm tra lại giao dịch',en:'Double-check the transaction'}
  },
  { id:'a2', type:'anomaly',
    kind:{vi:'Cảnh báo',en:'Alert'}, badge:'yellow',
    title:{vi:'Giao dịch bất thường phát hiện',en:'Suspicious transaction found'},
    desc:{vi:'Một giao dịch bất thường đã được phát hiện.',en:'A suspicious transaction was detected.'},
    time:{vi:'Hôm nay, 08:15',en:'Today, 08:15'},
    tip:{vi:'Xác minh nguồn giao dịch',en:'Verify the source'}
  },
  { id:'a3', type:'anomaly',
    kind:{vi:'Cảnh báo',en:'Alert'}, badge:'yellow',
    title:{vi:'Đăng nhập bất thường',en:'Unusual sign-in'},
    desc:{vi:'Có một đăng nhập lạ từ thiết bị mới.',en:'A sign-in from a new device was detected.'},
    time:{vi:'2 ngày trước',en:'2 days ago'},
    tip:{vi:'Đổi mật khẩu và bật 2FA',en:'Change password and enable 2FA'}
  }
];
function L(v){ const lang = localStorage.getItem('lang')||'vi'; return (v && typeof v==='object') ? (v[lang] || v.vi || '') : v; }

/* ===== Page wiring ===== */
const tabs=document.getElementById('tabs');
const list=document.getElementById('list');
const empty=document.getElementById('empty');
const q=document.getElementById('q');
const dTitle=document.getElementById('d-title');
const dDesc=document.getElementById('d-desc');
const dTip=document.getElementById('d-tip');
const act1=document.getElementById('act1');
const act2=document.getElementById('act2');
const progressWrap=document.getElementById('progress');
const progressBar=progressWrap.querySelector('i');

let currentTab='all', current=null;

function itemsForTab(){
  const term=(q.value||'').toLowerCase();
  return ALERTS.filter(a=>(currentTab==='all'||a.type===currentTab) &&
    (L(a.title).toLowerCase().includes(term)||L(a.desc).toLowerCase().includes(term)));
}
function render(){
  const rows=itemsForTab();
  list.innerHTML='';
  rows.forEach(a=>{
    const el=document.createElement('div');
    el.className='item'+(current&&current.id===a.id?' active':'');
    el.dataset.id=a.id;
    el.innerHTML=`
      <div class="badge ${a.badge}">${L(a.kind)}</div>
      <div><div class="t">${L(a.title)}</div><div class="sub">${L(a.desc)}</div></div>
      <div class="time">${L(a.time)}</div>`;
    list.appendChild(el);
  });
  empty.style.display=rows.length?'none':'block';
  if(rows.length && (!current || (currentTab!=='all' && current.type!==currentTab))) select(rows[0].id);
  else if(current){ // refresh selection text when language changes
    select(current.id);
  }
}
function select(id){
  current=ALERTS.find(a=>a.id==id);
  [...list.children].forEach(x=>x.classList.toggle('active',x.dataset.id===id));
  dTitle.textContent=L(current.title);
  dDesc.textContent =L(current.desc);
  dTip.textContent  =L(current.tip)||'';

  if(current.type==='budget'){
    act1.textContent=t('btn.adjustBudget'); act1.style.display='';
    act2.textContent=t('btn.seeReport');    act2.style.display='';
    progressWrap.style.display=''; progressBar.style.width=(current.progress||0)+'%';
  }else{
    act1.textContent=t('btn.checkTx');      act1.style.display='';
    act2.style.display='none';
    progressWrap.style.display='none';
  }
}

/* Tabs, search, delete */
tabs.addEventListener('click',e=>{
  const a=e.target.closest('a[data-tab]'); if(!a) return;
  e.preventDefault();
  [...tabs.children].forEach(tEl=>tEl.classList.remove('active'));
  a.classList.add('active');
  currentTab=a.dataset.tab; current=null; render();
});
list.addEventListener('click',e=>{
  const it=e.target.closest('.item'); if(it) select(it.dataset.id);
});
q.addEventListener('input',render);
document.getElementById('btnDelete').onclick=()=>{
  if(!current) return alert('Chưa chọn thông báo nào');
  const i=ALERTS.findIndex(a=>a.id===current.id);
  ALERTS.splice(i,1); current=null; render();
};

/* Language segmented */
langSeg.addEventListener('click', (e)=>{
  const btn=e.target.closest('button[data-lang]'); if(!btn) return;
  localStorage.setItem('lang', btn.dataset.lang);
  translatePage();
  render();
});

/* ===== Chatbox ===== */
const chatToggle=document.getElementById('chatToggle');
const chatbox=document.getElementById('chatbox');
const chatBody=document.getElementById('chatBody');
const chatInput=document.getElementById('chatInput');
const sendBtn=document.getElementById('sendBtn');

let greeted=false;
function addMsg(text,who='bot'){
  const wrap=document.createElement('div'); wrap.className='msg '+who;
  const av=document.createElement('div'); av.className='avatar-s'; av.textContent=who==='bot'?'🐷':'👤';
  const b=document.createElement('div'); b.className='bubble'; b.textContent=text;
  if(who==='bot'){wrap.append(av,b);}else{wrap.append(b,av);}
  chatBody.appendChild(wrap); chatBody.scrollTop=chatBody.scrollHeight;
}
function handleSend(){
  const ttxt=chatInput.value.trim(); if(!ttxt) return;
  addMsg(ttxt,'user'); chatInput.value='';
  setTimeout(()=>addMsg(t('chat.reply')),500);
}
function openChat(){
  chatbox.classList.add('open'); chatbox.setAttribute('aria-hidden','false');
  if(!greeted){ addMsg(t('chat.greet')); greeted=true; }
}
function closeChat(){ chatbox.classList.remove('open'); chatbox.setAttribute('aria-hidden','true'); }
chatToggle.onclick=()=> chatbox.classList.contains('open')?closeChat():openChat();
sendBtn.onclick=handleSend;
chatInput.onkeydown=e=>{ if(e.key==='Enter') handleSend(); };

/* ===== Init ===== */
(function initLang(){
  if(!localStorage.getItem('lang')) localStorage.setItem('lang','vi');
  translatePage();
  render();
})();
</script>
</body>
</html>
