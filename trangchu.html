<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title data-i18n="app.title">SmartExpense ‚Äî T·ªïng quan</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#eaf3f9; --card:#ffffff; --text:#0f172a; --muted:#64748b;
    --border:#e5e7eb; --blue:#2563eb; --blue-600:#1f4fd1;
    --green:#0ea5a0; --red:#ef4444;
    --radius:14px; --shadow:0 10px 26px rgba(15,23,42,.06);
    --soft:#f8fafc; --soft-2:#eef2f7; --chip:#111827;
    /* chat */
    --chat-bg:#f4fbff; --chat-typing-dot:#9ca3af;
  }
  html.dark{
    --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#9aa4b2;
    --border:#1f2937; --blue:#3b82f6; --green:#22c55e;
    --soft:#0b1424; --soft-2:#172033; --chip:#e5e7eb;
    /* chat (dark) */
    --chat-bg:#0d1526; --chat-typing-dot:#9aa4b2;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    display:grid;grid-template-columns:260px 1fr;min-height:100vh;
    transition:background .25s,color .25s;
  }
  .sidebar{background:var(--card);border-right:1px solid var(--border);padding:18px 14px}
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:8px}
  .brand .logo{width:40px;height:40px;border-radius:10px;overflow:hidden;background:#ffe8e0;display:grid;place-items:center;box-shadow:var(--shadow)}
  .brand .logo img{width:100%;height:100%;object-fit:cover}
  .brand b{font-size:18px}
  .nav{display:flex;flex-direction:column;gap:6px;margin-top:10px}
  .nav a{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;font-weight:700;color:var(--text);text-decoration:none;transition:background .2s,color .2s}
  .nav a .i{width:18px;text-align:center}
  .nav a:hover{background:rgba(37,99,235,.12)}
  html.dark .nav a:hover{background:rgba(59,130,246,.18)}
  .nav a.active{background:var(--blue);color:#fff}

  .main{padding:22px 24px 40px}
  .top{display:flex;align-items:center;gap:14px;margin:2px 0 14px}
  .top h1{margin:0;font-size:22px;font-weight:800}
  .search{margin-left:auto;display:flex;align-items:center;gap:12px}
  .search input{
    width:min(420px,40vw);height:40px;padding:0 16px;border:1px solid var(--border);
    border-radius:999px;background:var(--card);color:var(--text);outline:none
  }
  .icon{opacity:.8}
  .avatar{
    width:40px;height:40px;border-radius:50%;
    background:#fde68a url('avatar.png') center/cover no-repeat;
    display:grid;place-items:center;font-weight:800;border:2px solid var(--card);
    box-shadow:0 2px 6px rgba(0,0,0,.08)
  }

  .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:16px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  .kpi h4{margin:0 0 8px;font-size:13px;color:var(--muted);font-weight:800}
  .kpi .val{font-size:26px;font-weight:800;margin-bottom:6px}
  .kpi .sub{font-size:12px;color:var(--muted)}
  .sub .up{color:#16a34a;font-weight:800}
  .sub .down{color:var(--red);font-weight:800}

  .content{display:grid;grid-template-columns:1.6fr 1fr 340px;gap:16px}

  .chart .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .chart .head b{font-size:14px}
  .chart select{
    height:32px;border:1px solid var(--border);border-radius:10px;padding:0 10px;background:var(--card);color:var(--text)
  }
  .bars{
    height:170px;border:1px solid var(--border);border-radius:12px;background:var(--card);
    display:flex;align-items:flex-end;gap:14px;padding:12px 14px
  }
  .bar{flex:1;background:#cfd8e3;border-radius:8px 8px 0 0;position:relative}
  html.dark .bar{background:#22314a}
  .bar::before{
    content:"";position:absolute;left:0;right:0;bottom:0;height:24%;
    background:var(--soft-2);border-radius:8px 8px 0 0
  }

  .cat ul{list-style:none;margin:0;padding:0}
  .cat li{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px dashed var(--soft-2)}
  .cat li:last-child{border-bottom:0}
  .cat .l{display:flex;align-items:center;gap:10px;color:#475569}
  html.dark .cat .l{color:#c3c9d4}
  .cat .r{font-weight:800}

  .table .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .table .right{display:flex;align-items:center;gap:10px}
  .table .right input{
    width:220px;height:36px;border:1px solid var(--border);border-radius:8px;padding:0 10px;background:var(--soft);color:var(--text)
  }
  .table .add{height:36px;padding:0 12px;border:0;border-radius:10px;background:var(--chip);color:#fff;font-weight:800;cursor:pointer}
  table{width:100%;border-collapse:collapse}
  th,td{padding:12px 6px;border-bottom:1px solid var(--soft-2);text-align:left}
  th{font-size:12px;color:var(--muted);letter-spacing:.4px}

  .panel .title{font-weight:800;margin-bottom:10px}
  .panel .row{display:flex;align-items:center;gap:10px;margin:8px 0}
  .panel .row span{width:170px;color:#6b7280}
  html.dark .panel .row span{color:#a5adba}
  .panel input{
    flex:1;height:40px;border:1px solid var(--border);border-radius:10px;padding:0 10px;background:var(--soft);color:var(--text)
  }
  .panel .row button{height:40px;border:0;border-radius:10px;background:#e5e7eb;padding:0 12px;font-weight:700;cursor:pointer}
  html.dark .panel .row button{background:#1f2937;color:#e5e7eb}
  .guide h4{margin:0 0 8px;font-size:14px}
  .guide p{margin:6px 0;font-size:13px;color:#475569}
  html.dark .guide p{color:#c3c9d4}

  .pig-float{
    position:fixed;right:32px;bottom:26px;width:76px;height:76px;border-radius:18px;background:#ffe8e0;
    display:grid;place-items:center;box-shadow:var(--shadow);font-size:36px;z-index:20;cursor:pointer;border:0
  }
  .pig-float img{width:64px;height:64px}

  .chatbox{
    position:fixed;right:26px;bottom:112px;width:340px;
    background:var(--card);border:1px solid var(--border);border-radius:14px;
    box-shadow:var(--shadow);overflow:hidden;display:none;z-index:30;
    grid-template-rows:56px 1fr 60px;
  }
  .chatbox.open{display:grid}
  .chat-head{
    background:#1da1c9;color:#fff;display:flex;align-items:center;gap:10px;
    padding:10px 12px;font-weight:800;
  }
  .chat-head img{width:28px;height:28px;border-radius:6px;background:#ffe8e0}
  .chat-title{line-height:1.2}
  .chat-sub{font-weight:600;opacity:.95}
  .chat-body{background:var(--chat-bg);overflow:auto;padding:10px;scroll-behavior:smooth;max-height:380px}
  .msg{display:flex;align-items:flex-end;margin:8px 0;gap:8px}
  .msg.user{justify-content:flex-end}
  .bubble{max-width:78%;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:var(--card);font-size:14px;line-height:1.35}
  .msg.bot .bubble{border-radius:14px 14px 14px 4px}
  .msg.user .bubble{border-radius:14px 14px 4px 14px;background:var(--blue);border:none;color:#fff}
  .avatar-s{width:26px;height:26px;border-radius:50%;display:grid;place-items:center;background:#ffe8e0;flex:0 0 26px;font-size:14px}
  .typing{display:inline-block;min-width:34px}
  .typing span{display:inline-block;width:6px;height:6px;background:var(--chat-typing-dot);border-radius:50%;margin:0 2px;animation:b 1s infinite ease-in-out}
  .typing span:nth-child(2){animation-delay:.15s}.typing span:nth-child(3){animation-delay:.3s}
  @keyframes b{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-4px)}}

  .chat-input{background:var(--card);border-top:1px solid var(--border);display:flex;align-items:center;gap:8px;padding:8px}
  #chatInput{flex:1;height:40px;border:1px solid var(--border);border-radius:999px;padding:0 12px;background:var(--card);color:var(--text);outline:none}
  #sendBtn{width:38px;height:38px;border-radius:999px;border:0;background:var(--blue);color:#fff;display:grid;place-items:center;cursor:pointer}

  @media (max-width:1200px){
    body{grid-template-columns:230px 1fr}
    .content{grid-template-columns: 1.2fr 1fr 320px}
  }
  @media (max-width:1024px){
    body{grid-template-columns:1fr}
    .sidebar{position:sticky;top:0;z-index:20}
    .kpi{grid-template-columns:repeat(2,1fr)}
    .content{grid-template-columns:1fr;gap:14px}
    .chatbox{right:16px;bottom:96px;width:min(92vw,360px)}
    .pig-float{right:16px}
  }
</style>
</head>
<body>

  <aside class="sidebar">
    <div class="brand">
      <div class="logo">
        <img src="https://play-lh.googleusercontent.com/oIYzM27-Lax7Zkg4grAxxLYRQkxHrs1osx0Qbf-jADQNpv9400yo0qYcLzDn-Qz2M8A=w480-h960-rw" alt="">
      </div>
      <b data-i18n="brand.name">SmartExpense</b>
    </div>
    <nav class="nav">
      <a href="trangchu.html" class="active"><span class="i">üè†</span> <span data-i18n="nav.overview">T·ªïng quan</span></a>
      <a href="danhsachchitieu.html"><span class="i">üßæ</span> <span data-i18n="nav.list">Danh s√°ch chi ti√™u</span></a>
      <a href="lichsuchitieu.html"><span class="i">üïò</span> <span data-i18n="nav.history">L·ªãch s·ª≠ chi ti√™u</span></a>
      <a href="lenlichchitieu.html"><span class="i">üìÖ</span> <span data-i18n="nav.schedule">L√™n l·ªãch chi ti√™u</span></a>
      <a href="loaichitieu.html"><span class="i">üè∑Ô∏è</span> <span data-i18n="nav.category">Lo·∫°i chi ti√™u</span></a>
      <a href="baocao.html"><span class="i">üìä</span> <span data-i18n="nav.report">B√°o c√°o</span></a>
      <a href="hoso.html"><span class="i">üë§</span> <span data-i18n="nav.profile">H·ªì s∆°</span></a>
      <a href="caidat.html"><span class="i">‚öôÔ∏è</span> <span data-i18n="nav.settings">C√†i ƒë·∫∑t</span></a>
      <a href="login.html"><span class="i">‚Ü™Ô∏è</span> <span data-i18n="nav.logout">ƒêƒÉng xu·∫•t</span></a>
    </nav>
  </aside>

  <main class="main">
    <div class="top">
      <h1 data-i18n="page.heading">T·ªïng quan</h1>
      <div class="search">
        <input data-i18n-placeholder="search.placeholder" placeholder="T√¨m giao d·ªãch‚Ä¶">
        <span class="icon">üîç</span>
      </div>
    </div>

    <section class="kpi">
      <div class="card">
        <h4 data-i18n="kpi.balance">S·ªë d∆∞</h4>
        <div class="val">36,450,000</div>
        <div class="sub" data-i18n="kpi.updated_today">C·∫≠p nh·∫≠t h√¥m nay</div>
      </div>
      <div class="card">
        <h4 data-i18n="kpi.expense_month">Chi th√°ng n√†y</h4>
        <div class="val" style="color:var(--red)">8,320,000</div>
        <div class="sub"><span class="down">+12%</span> <span data-i18n="kpi.vs_last_month">so v·ªõi th√°ng tr∆∞·ªõc</span></div>
      </div>
      <div class="card">
        <h4 data-i18n="kpi.income_month">Thu th√°ng n√†y</h4>
        <div class="val" style="color:var(--green)">10,500,000</div>
        <div class="sub"><span class="up">+4%</span> <span data-i18n="kpi.vs_last_month">so v·ªõi th√°ng tr∆∞·ªõc</span></div>
      </div>
      <div class="card">
        <h4 data-i18n="kpi.saving_goal">M·ª•c ti√™u ti·∫øt ki·ªám</h4>
        <div class="val">50,000,000</div>
        <div class="sub"><span data-i18n="kpi.progress">28% ho√†n th√†nh</span></div>
        <div style="height:8px;background:var(--soft-2);border-radius:999px;margin-top:8px;overflow:hidden">
          <div style="width:28%;height:100%;background:#60a5fa"></div>
        </div>
      </div>
    </section>

    <section class="content">
      <div class="card chart">
        <div class="head">
          <b data-i18n="chart.trend">Xu h∆∞·ªõng chi ti√™u</b>
          <select data-i18n-select="chart.range">
            <option value="30" data-i18n="chart.range.30">30 ng√†y</option>
            <option value="60" data-i18n="chart.range.60">60 ng√†y</option>
            <option value="90" data-i18n="chart.range.90">90 ng√†y</option>
          </select>
        </div>
        <div class="bars">
          <div class="bar" style="height:18%"></div>
          <div class="bar" style="height:58%"></div>
          <div class="bar" style="height:50%"></div>
          <div class="bar" style="height:68%"></div>
          <div class="bar" style="height:56%"></div>
          <div class="bar" style="height:92%"></div>
        </div>
      </div>

      <div class="card cat">
        <b data-i18n="cat.by_category">Theo h·∫°ng m·ª•c</b>
        <ul>
          <li><div class="l">üçΩÔ∏è <span data-i18n="cat.food">ƒÇn u·ªëng</span></div><div class="r">2,150,000</div></li>
          <li><div class="l">üöó <span data-i18n="cat.transport">Di chuy·ªÉn</span></div><div class="r">1,120,000</div></li>
          <li><div class="l">üè† <span data-i18n="cat.housing">Nh√† ·ªü</span></div><div class="r">3,400,000</div></li>
        </ul>
      </div>

      <div class="col-right">
        <div class="card panel">
          <div class="title" data-i18n="panel.title">üü† S·ªï chi ti√™u c·ªßa b·∫°n</div>
          <div class="row"><span data-i18n="panel.total_month">T·ªïng chi ti√™u th√°ng n√†y:</span><input value="10,500,000ƒë" readonly></div>
          <div class="row"><span data-i18n="panel.total_today">T·ªïng chi ti√™u h√¥m nay:</span><input value="280,000ƒë" readonly></div>
          <div class="row"><span data-i18n="panel.remaining">S·ªë ti·ªÅn c√≤n l·∫°i:</span><input value="0ƒë" readonly></div>
          <div class="row"><input data-i18n-placeholder="panel.placeholder" placeholder="Nh·∫≠p chi ti√™u h√¥m nay" /><button data-i18n="panel.add">Th√™m</button></div>
        </div>
        <div class="card guide" style="margin-top:16px">
          <h4 data-i18n="guide.title">H∆∞·ªõng d·∫´n:</h4>
          <p><b data-i18n="guide.syntax.title">C√∫ ph√°p:</b> <span data-i18n="guide.syntax.value">[chi ti√™u] [s·ªë ti·ªÅn]</span></p>
          <p><b data-i18n="guide.example.title">V√≠ d·ª•:</b> <span data-i18n="guide.example.value">‚ÄúC√† ph√™ 10000‚Äù</span></p>
        </div>
      </div>

      <div class="card table" style="grid-column:1 / span 2">
        <div class="head">
          <b data-i18n="table.recent">Giao d·ªãch g·∫ßn ƒë√¢y</b>
          <div class="right">
            <input data-i18n-placeholder="table.filter" placeholder="L·ªçc‚Ä¶">
            <button class="add" data-i18n="table.add">Th√™m</button>
          </div>
        </div>
        <table>
          <thead><tr><th data-i18n="table.col.category">H·∫†NG M·ª§C</th><th data-i18n="table.col.desc">M√î T·∫¢</th><th></th></tr></thead>
          <tbody>
            <tr><td data-i18n="cat.food">ƒÇn u·ªëng</td><td data-i18n="table.sample.lunch">B·ªØa tr∆∞a</td><td></td></tr>
            <tr><td data-i18n="table.sample.salary_cat">L∆∞∆°ng</td><td data-i18n="table.sample.salary_desc">Th√°ng 9</td><td></td></tr>
            <tr><td data-i18n="cat.transport">Di chuy·ªÉn</td><td data-i18n="table.sample.grab">Grab</td><td></td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <div id="chatbox" class="chatbox" aria-hidden="true">
    <div class="chat-head">
      <img src="https://play-lh.googleusercontent.com/oIYzM27-Lax7Zkg4grAxxLYRQkxHrs1osx0Qbf-jADQNpv9400yo0qYcLzDn-Qz2M8A=w480-h960-rw" alt="">
      <div>
        <div class="chat-title" data-i18n="chat.title">Tr·ª£ l√Ω th√¥ng minh</div>
        <div class="chat-sub" data-i18n="chat.subtitle">Xin ch√†o! üëã R·∫•t vui khi ƒë∆∞·ª£c h·ªó tr·ª£ b·∫°n</div>
      </div>
    </div>
    <div id="chatBody" class="chat-body"></div>
    <div class="chat-input">
      <input id="chatInput" type="text" data-i18n-placeholder="chat.placeholder" placeholder="Vi·∫øt tin nh·∫Øn‚Ä¶">
      <button id="sendBtn" title="G·ª≠i" aria-label="G·ª≠i">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 12L20 4L12 20L11 13L4 12Z" fill="currentColor"/></svg>
      </button>
    </div>
  </div>

  <button id="chatToggle" class="pig-float" aria-label="M·ªü tr·ª£ l√Ω">
    <img src="https://play-lh.googleusercontent.com/oIYzM27-Lax7Zkg4grAxxLYRQkxHrs1osx0Qbf-jADQNpv9400yo0qYcLzDn-Qz2M8A=w480-h960-rw" alt="">
  </button>

<script>
  /* ===================== THEME + I18N CORE ===================== */
  const translations = {
    vi: {
      "app.title":"SmartExpense ‚Äî T·ªïng quan",
      "brand.name":"SmartExpense",
      "nav.overview":"T·ªïng quan","nav.list":"Danh s√°ch chi ti√™u","nav.history":"L·ªãch s·ª≠ chi ti√™u",
      "nav.schedule":"L√™n l·ªãch chi ti√™u","nav.category":"Lo·∫°i chi ti√™u","nav.report":"B√°o c√°o",
      "nav.profile":"H·ªì s∆°","nav.settings":"C√†i ƒë·∫∑t","nav.logout":"ƒêƒÉng xu·∫•t",
      "page.heading":"T·ªïng quan",
      "search.placeholder":"T√¨m giao d·ªãch‚Ä¶",
      "kpi.balance":"S·ªë d∆∞","kpi.updated_today":"C·∫≠p nh·∫≠t h√¥m nay","kpi.expense_month":"Chi th√°ng n√†y",
      "kpi.income_month":"Thu th√°ng n√†y","kpi.vs_last_month":"so v·ªõi th√°ng tr∆∞·ªõc",
      "kpi.saving_goal":"M·ª•c ti√™u ti·∫øt ki·ªám","kpi.progress":"28% ho√†n th√†nh",
      "chart.trend":"Xu h∆∞·ªõng chi ti√™u","chart.range.30":"30 ng√†y","chart.range.60":"60 ng√†y","chart.range.90":"90 ng√†y",
      "cat.by_category":"Theo h·∫°ng m·ª•c","cat.food":"ƒÇn u·ªëng","cat.transport":"Di chuy·ªÉn","cat.housing":"Nh√† ·ªü",
      "panel.title":"üü† S·ªï chi ti√™u c·ªßa b·∫°n","panel.total_month":"T·ªïng chi ti√™u th√°ng n√†y:","panel.total_today":"T·ªïng chi ti√™u h√¥m nay:",
      "panel.remaining":"S·ªë ti·ªÅn c√≤n l·∫°i:","panel.placeholder":"Nh·∫≠p chi ti√™u h√¥m nay","panel.add":"Th√™m",
      "guide.title":"H∆∞·ªõng d·∫´n:","guide.syntax.title":"C√∫ ph√°p:","guide.syntax.value":"[chi ti√™u] [s·ªë ti·ªÅn]",
      "guide.example.title":"V√≠ d·ª•:","guide.example.value":"‚ÄúC√† ph√™ 10000‚Äù",
      "table.recent":"Giao d·ªãch g·∫ßn ƒë√¢y","table.filter":"L·ªçc‚Ä¶","table.add":"Th√™m",
      "table.col.category":"H·∫†NG M·ª§C","table.col.desc":"M√î T·∫¢",
      "table.sample.lunch":"B·ªØa tr∆∞a","table.sample.salary_cat":"L∆∞∆°ng","table.sample.salary_desc":"Th√°ng 9","table.sample.grab":"Grab",
      "chat.title":"Tr·ª£ l√Ω th√¥ng minh","chat.subtitle":"Xin ch√†o! üëã R·∫•t vui khi ƒë∆∞·ª£c h·ªó tr·ª£ b·∫°n","chat.placeholder":"Vi·∫øt tin nh·∫Øn‚Ä¶",
      /* chat dynamic */
      "chat.greeting":"T√¥i l√† tr·ª£ l√Ω SmartExpense. B·∫°n c√≥ th·ªÉ nh·ªù t√¥i t·∫°o chi ti√™u, xem b√°o c√°o, ho·∫∑c h·ªèi m·∫πo s·ª≠ d·ª•ng.",
      "chat.ready":"M√¨nh ƒë√£ nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu. B·∫°n mu·ªën m√¨nh l√†m g√¨ ti·∫øp theo?",
      "chat.processing":"ƒêang t·∫°o c√¢u tr·∫£ l·ªùi d·ª±a theo y√™u c·∫ßu‚Ä¶",
      "chat.created_next":"T√¥i ƒë√£ t·∫°o th√†nh c√¥ng chi ti√™u ti·∫øp theo c·ªßa th√°ng sau. B·∫°n h√£y ki·ªÉm tra ·ªü m·ª•c Danh s√°ch chi ti√™u."
    },
    en: {
      "app.title":"SmartExpense ‚Äî Overview",
      "brand.name":"SmartExpense",
      "nav.overview":"Overview","nav.list":"Expense List","nav.history":"History",
      "nav.schedule":"Budget planner","nav.category":"Categories","nav.report":"Reports",
      "nav.profile":"Profile","nav.settings":"Settings","nav.logout":"Log out",
      "page.heading":"Overview",
      "search.placeholder":"Search transactions‚Ä¶",
      "kpi.balance":"Balance","kpi.updated_today":"Updated today","kpi.expense_month":"This month‚Äôs expenses",
      "kpi.income_month":"This month‚Äôs income","kpi.vs_last_month":"vs last month",
      "kpi.saving_goal":"Saving goal","kpi.progress":"28% completed",
      "chart.trend":"Spending trend","chart.range.30":"30 days","chart.range.60":"60 days","chart.range.90":"90 days",
      "cat.by_category":"By category","cat.food":"Food & drinks","cat.transport":"Transport","cat.housing":"Housing",
      "panel.title":"üü† Your expense book","panel.total_month":"Total this month:","panel.total_today":"Total today:",
      "panel.remaining":"Remaining amount:","panel.placeholder":"Enter today‚Äôs expense","panel.add":"Add",
      "guide.title":"Guide:","guide.syntax.title":"Syntax:","guide.syntax.value":"[item] [amount]",
      "guide.example.title":"Example:","guide.example.value":"'Coffee 10000'",
      "table.recent":"Recent transactions","table.filter":"Filter‚Ä¶","table.add":"Add",
      "table.col.category":"CATEGORY","table.col.desc":"DESCRIPTION",
      "table.sample.lunch":"Lunch","table.sample.salary_cat":"Salary","table.sample.salary_desc":"Sep","table.sample.grab":"Grab",
      "chat.title":"Smart assistant","chat.subtitle":"Hi! üëã Happy to help","chat.placeholder":"Type a message‚Ä¶",
      /* chat dynamic */
      "chat.greeting":"I am your SmartExpense assistant. Ask me to add expenses, show reports, or tips.",
      "chat.ready":"Got it. What should I do next?",
      "chat.processing":"Preparing an answer‚Ä¶",
      "chat.created_next":"Created your next month expense entry. Check the Expense List."
    }
  };

  function applyTheme(theme){
    document.documentElement.classList.toggle('dark', theme === 'dark');
  }

  function applyLanguage(lang){
    const dict = translations[lang] || translations.vi;
    document.querySelectorAll("[data-i18n]").forEach(el=>{
      const k = el.dataset.i18n;
      if (dict[k]) el.textContent = dict[k];
    });
    document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
      const k = el.dataset.i18nPlaceholder;
      if (dict[k]) el.placeholder = dict[k];
    });
    document.querySelectorAll("option[data-i18n]").forEach(opt=>{
      const k = opt.dataset.i18n;
      if (dict[k]) opt.textContent = dict[k];
    });
    document.title = dict["app.title"] || document.title;
    document.documentElement.lang = lang;
  }

  function getGreeting(lang){
    const dict = translations[lang] || translations.vi;
    return dict["chat.greeting"];
  }
  function updateGreetingBubble(lang){
    const g = document.querySelector('.bubble[data-greeting="1"]');
    if (g) g.textContent = getGreeting(lang);
  }

  // Initial load from localStorage
  const theme = localStorage.getItem('theme') || 'light';
  const lang  = localStorage.getItem('lang')  || 'vi';
  applyTheme(theme);
  applyLanguage(lang);

  // Sync from other pages (e.g., caidat.html)
  window.addEventListener('storage', (e)=>{
    if (e.key === 'theme' && e.newValue) applyTheme(e.newValue);
    if (e.key === 'lang'  && e.newValue){
      applyLanguage(e.newValue);
      updateGreetingBubble(e.newValue);
    }
  });

  /* ===================== SEARCH FILTER + CHATBOX ===================== */
  const filter = document.querySelector('.table .right input');
  const rows = [...document.querySelectorAll('tbody tr')];
  if (filter) {
    filter.addEventListener('input', e=>{
      const q = e.target.value.toLowerCase();
      rows.forEach(r=> r.style.display = r.textContent.toLowerCase().includes(q) ? '' : 'none');
    });
  }

  const chatToggle = document.getElementById('chatToggle');
  const chatbox = document.getElementById('chatbox');
  const chatBody = document.getElementById('chatBody');
  const chatInput = document.getElementById('chatInput');
  const sendBtn  = document.getElementById('sendBtn');

  let greeted = false;

  function scrollBottom(){ chatBody.scrollTop = chatBody.scrollHeight; }

  function addMsg(text, who='bot'){
    const wrap = document.createElement('div');
    wrap.className = `msg ${who}`;
    const avatar = document.createElement('div');
    avatar.className = 'avatar-s';
    avatar.textContent = who==='bot' ? 'üê∑' : 'üë§';
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.innerText = text;
    if (who==='bot'){ wrap.append(avatar, bubble); } else { wrap.append(bubble, avatar); }
    chatBody.appendChild(wrap);
    scrollBottom();
  }

  function addTyping(){
    const wrap = document.createElement('div');
    wrap.className = 'msg bot';
    wrap.dataset.typing = '1';
    wrap.innerHTML = `<div class="avatar-s">üê∑</div>
      <div class="bubble"><span class="typing"><span></span><span></span><span></span></span></div>`;
    chatBody.appendChild(wrap);
    scrollBottom();
    return wrap;
  }

  function botSay(text, delay=0){
    const t = addTyping();
    setTimeout(()=>{ t.remove(); addMsg(text,'bot'); }, Math.max(300, delay));
  }

  function openChat() {
    chatbox.classList.add('open');
    chatbox.setAttribute('aria-hidden','false');
    if (!greeted) {
      // greeting bubble that can live-update on language change
      const typing = addTyping();
      setTimeout(()=>{
        typing.remove();
        const wrap = document.createElement('div');
        wrap.className = 'msg bot';
        const avatar = document.createElement('div');
        avatar.className = 'avatar-s';
        avatar.textContent = 'üê∑';
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.setAttribute('data-greeting','1');
        bubble.textContent = getGreeting(localStorage.getItem('lang') || 'vi');
        wrap.append(avatar, bubble);
        chatBody.appendChild(wrap);
        scrollBottom();
      }, 350);
      greeted = true;
    }
    setTimeout(()=> chatInput.focus(), 100);
  }
  function closeChat() {
    chatbox.classList.remove('open');
    chatbox.setAttribute('aria-hidden','true');
  }
  chatToggle.addEventListener('click', ()=> chatbox.classList.contains('open') ? closeChat() : openChat());

  function handleSend(){
    const txt = chatInput.value.trim();
    if (!txt) return;
    addMsg(txt,'user');
    chatInput.value = '';

    const langNow = localStorage.getItem('lang') || 'vi';
    const dict = translations[langNow] || translations.vi;
    const say = txt.toLowerCase();

    const isCreateNextMonth =
      (langNow==='vi' && (say.includes('t·∫°o') && (say.includes('th√°ng') || say.includes('thang')))) ||
      (langNow==='en' && (say.includes('create') || say.includes('next month')));

    if (isCreateNextMonth) {
      botSay(dict["chat.processing"], 900);
      setTimeout(()=> botSay(dict["chat.created_next"], 1200), 1100);
    } else {
      botSay(dict["chat.ready"]);
    }
  }
  sendBtn.addEventListener('click', handleSend);
  chatInput.addEventListener('keydown', (e)=>{ if (e.key==='Enter') handleSend(); });
  
</script>
<script>
/* ======= SCHEDULE WIDGET + BADGE for trangchu.html ======= */
(function(){
  const KEY = 'sp_schedules';

  const load = () => {
    try { return JSON.parse(localStorage.getItem(KEY) || '[]'); }
    catch { return []; }
  };
  const fmt = n => (+n).toLocaleString('vi-VN') + 'ƒë';
  const label = t => t==='daily'?'H·∫±ng ng√†y':t==='weekly'?'H·∫±ng tu·∫ßn':t==='monthly'?'H·∫±ng th√°ng':'M·ªôt l·∫ßn';

  /* ---------- Card ·ªü c·ªôt ph·∫£i ---------- */
  function ensureScheduleCard() {
    // t√¨m ƒë√∫ng c·ªôt ph·∫£i nh∆∞ b·ªë c·ª•c hi·ªán t·∫°i
    const rightCol = document.querySelector('.col-right') || document.querySelector('.content > .col-right');
    if (!rightCol) return null;

    let card = document.getElementById('scheduleCard');
    if (!card) {
      card = document.createElement('div');
      card.className = 'card';
      card.id = 'scheduleCard';
      card.style.marginTop = '16px';
      card.innerHTML = `
        <div class="panel">
          <div class="title">üìÖ L·ªãch chi ti√™u ƒëang b·∫≠t</div>
          <div id="sched-content" style="padding:8px 0;color:var(--muted)">ƒêang t·∫£i...</div>
        </div>`;
      rightCol.appendChild(card);
    }
    return card;
  }

  function renderScheduleCard() {
    const card = ensureScheduleCard(); if (!card) return;
    const el = card.querySelector('#sched-content');
    const rows = load().filter(r => r.enabled);

    if (!rows.length) {
      el.innerHTML = `<p style="margin:0;color:var(--muted)">Ch∆∞a c√≥ l·ªãch n√†o. V√†o <b>L√™n l·ªãch chi ti√™u</b> ƒë·ªÉ t·∫°o.</p>`;
      return;
    }

    const total = rows.reduce((s,r) => s + (+r.amount||0), 0);
    const items = rows.slice(0,5).map(r => `
      <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed var(--soft-2)">
        <span style="display:flex;align-items:center;gap:6px;color:#475569">
          üóìÔ∏è <b>${r.name}</b> <span style="font-size:12px;color:var(--muted)">(${label(r.type)})</span>
        </span>
        <span style="font-weight:800">${fmt(r.amount)}</span>
      </div>
    `).join('');

    const more = rows.length>5 ? `<div style="font-size:12px;color:var(--muted);padding-top:6px">+${rows.length-5} l·ªãch kh√°c‚Ä¶</div>` : '';
    const footer = `<div style="padding-top:8px;font-weight:800">T·ªïng: ${fmt(total)}</div>`;

    el.innerHTML = items + more + footer;
  }

  /* ---------- Badge ·ªü sidebar ---------- */
  function ensureSidebarBadge() {
    // link ‚ÄúL√™n l·ªãch chi ti√™u‚Äù trong nav
    const link = [...document.querySelectorAll('.nav a')].find(a =>
      /L√™n l·ªãch chi ti√™u|schedule/i.test(a.textContent) || (a.getAttribute('href')||'').includes('lenlich')
    );
    if (!link) return;

    let badge = link.querySelector('.sched-badge');
    if (!badge) {
      badge = document.createElement('span');
      badge.className = 'sched-badge';
      badge.style.cssText = `
        margin-left:auto;min-width:22px;height:22px;border-radius:999px;padding:0 6px;
        background:#efefef;color:#111;display:inline-grid;place-items:center;font-size:12px;font-weight:800
      `;
      // n·∫øu item ƒëang active c√≥ n·ªÅn xanh, ƒë·ªïi badge cho n·ªïi b·∫≠t
      if (link.classList.contains('active')) { badge.style.background = '#0b5bd7'; badge.style.color = '#fff'; }
      link.appendChild(badge);
    }
    return badge;
  }

  function renderSidebarBadge() {
    const count = load().filter(r => r.enabled).length;
    const badge = ensureSidebarBadge();
    if (!badge) return;
    badge.textContent = count;
    badge.style.display = count ? 'inline-grid' : 'none';
  }

  /* ---------- Render + sync ---------- */
  function renderAll(){
    renderScheduleCard();
    renderSidebarBadge();
  }

  renderAll();
  window.addEventListener('storage', e => {
    if (e.key === KEY || e.key === KEY + '_ts') renderAll();
  });
})();
</script>

</body>
</html>
